<!-- Modal Overlay -->
@if (isOpen()) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-content" [class.dark]="darkMode()" [attr.data-theme]="currentThemeIndex() + 1">
      <!-- Header -->
      <div class="modal-header">
        <h3 class="modal-title">Editar Cuenta</h3>
        <button type="button" class="btn-close" (click)="closeModal()" aria-label="Cerrar">
          <span>&times;</span>
        </button>
      </div>

      <!-- Body -->
      <div class="modal-body">
        @if (account()) {
          <div class="account-info">
            <div class="account-name">{{ account().name }}</div>
            <div class="account-type">{{ account().type === 'savings' ? 'Cuenta de Ahorros' : 'Tarjeta de Crédito' }}</div>
          </div>

          <!-- Balance Section -->
          <div class="form-section">
            <label class="form-label">{{ account().type === 'credit' ? 'Monto Disponible' : 'Saldo Actual' }}</label>
            <div class="input-group">
              <span class="input-prefix">S/</span>
              <input
                type="number"
                class="form-control"
                step="0.01"
                [(ngModel)]="editData().balance"
                placeholder="0.00"
              />
            </div>
            <small class="form-text">{{ account().type === 'credit' ? 'Monto disponible en la tarjeta' : 'El saldo actual de la cuenta' }}</small>
          </div>

          <!-- Credit Limit Section (only for credit cards) -->
          @if (account().type === 'credit') {
            <div class="form-section">
              <label class="form-label">Límite de Crédito</label>
              <div class="input-group">
                <span class="input-prefix">S/</span>
                <input
                  type="number"
                  class="form-control"
                  step="0.01"
                  [(ngModel)]="editData().creditLimit"
                  placeholder="0.00"
                />
              </div>
              <small class="form-text">Límite total de la tarjeta de crédito</small>
            </div>
          }

          <!-- Savings Goal Section (only for savings accounts) - always show input (no toggle) -->
          @if (account().type === 'savings') {
            <div class="form-section">
              <div class="goal-input">
                <label class="form-label">Monto objetivo</label>
                <div class="input-group">
                  <span class="input-prefix">S/</span>
                  <input
                    type="number"
                    class="form-control"
                    step="0.01"
                    [(ngModel)]="editData().goals.balanceTarget"
                    placeholder="0.00"
                  />
                </div>
                <small class="form-text">Monto que deseas alcanzar</small>
              </div>
            </div>
          }
        }
      </div>

      <!-- Footer -->
      <div class="modal-footer">
        <div class="d-flex justify-content-center gap-3 w-100">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="closeModal()"
            [disabled]="isSaving()"
          >
            Cancelar
          </button>
          <button
            type="button"
            class="btn btn-primary"
            (click)="saveChanges()"
            [disabled]="isSaving()"
          >
            @if (isSaving()) {
              <span class="spinner-border spinner-border-sm me-2"></span>
              Guardando...
            } @else {
              Guardar Cambios
            }
          </button>
        </div>
      </div>
      </div>
    </div>
  </div>
}