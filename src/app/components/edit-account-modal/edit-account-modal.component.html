<!-- Modal Overlay -->
@if (isOpen()) {
  <div class="modal-overlay" (click)="closeModal()"></div>
  <div class="modal-container">
    <div class="modal-content" [class.dark]="darkMode()" [attr.data-theme]="currentThemeIndex() + 1">
      <!-- Header -->
      <div class="modal-header">
        <h3 class="modal-title">Editar Cuenta</h3>
        <button type="button" class="btn-close" (click)="closeModal()" aria-label="Cerrar">
          <span>&times;</span>
        </button>
      </div>

      <!-- Body -->
      <div class="modal-body">
        @if (account()) {
          <div class="account-info">
            <div class="account-name">{{ account().name }}</div>
            <div class="account-type">{{ account().type === 'savings' ? 'Cuenta de Ahorros' : 'Tarjeta de Cr√©dito' }}</div>
          </div>

          <!-- Balance Section -->
          <div class="form-section">
            <label class="form-label">Saldo Actual</label>
            <div class="input-group">
              <span class="input-prefix">S/</span>
              <input
                type="number"
                class="form-control"
                step="0.01"
                [(ngModel)]="editData().balance"
                placeholder="0.00"
              />
            </div>
            <small class="form-text">El saldo actual de la cuenta</small>
          </div>

          <!-- Savings Goal Section (only for savings accounts) -->
          @if (account().type === 'savings') {
            <div class="form-section">
              <div class="goal-toggle">
                <label class="toggle-label">
                  <input
                    type="checkbox"
                    [(ngModel)]="editData().goals.isActive"
                    (change)="toggleSavingsGoal()"
                  />
                  <span class="toggle-slider"></span>
                  Meta de ahorro
                </label>
              </div>

              @if (editData().goals.isActive) {
                <div class="goal-input">
                  <label class="form-label">Monto objetivo</label>
                  <div class="input-group">
                    <span class="input-prefix">S/</span>
                    <input
                      type="number"
                      class="form-control"
                      step="0.01"
                      [(ngModel)]="editData().goals.balanceTarget"
                      placeholder="0.00"
                    />
                  </div>
                  <small class="form-text">Monto que deseas alcanzar</small>
                </div>
              }
            </div>
          }
        }
      </div>

      <!-- Footer -->
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="closeModal()"
          [disabled]="isSaving()"
        >
          Cancelar
        </button>
        <button
          type="button"
          class="btn btn-primary"
          (click)="saveChanges()"
          [disabled]="isSaving()"
        >
          @if (isSaving()) {
            <span class="spinner"></span>
            Guardando...
          } @else {
            Guardar Cambios
          }
        </button>
      </div>
    </div>
  </div>
}